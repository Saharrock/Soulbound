<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Soulbound.Views.GoalHistoryPage"
             xmlns:models="clr-namespace:Soulbound.Models"
             xmlns:viewmodels="clr-namespace:Soulbound.ViewModels"
             BackgroundColor ="#6c2d2c"
             Title="GoalHistoryPage">

    <VerticalStackLayout Spacing="20" Padding="10">

        <Label Text="Active Goals" FontSize="20" TextColor="White"/>
        <CollectionView ItemsSource="{Binding ActiveGoals}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Goal">
                    <Border StrokeThickness="1">
                        <StackLayout Padding="10" BackgroundColor="#9f4636">
                            <!-- Даты сверху -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- Дата создания -->
                                <Label 
                Text="{Binding CreatedAt, StringFormat='Created: {0:dd/MM/yyyy}'}"
                TextColor="Green"
                FontSize="12"
                Grid.Column="0"
                HorizontalOptions="Start" />

                                <!-- Дата окончания -->
                                <Label 
                Text="{Binding EndDate, StringFormat='Ends: {0:dd/MM/yyyy}'}"
                TextColor="Red"
                FontSize="12"
                Grid.Column="1"
                HorizontalOptions="End" />
                            </Grid>

                            <Label FontAttributes="Bold" Text="{Binding Title}" />
                            <Label FontAttributes="Bold" Text="{Binding Description}" />
                            <Label FontAttributes="Bold" Text="{Binding GoalTime}" />

                            <!-- НИЗ -->
                            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*">

                                <!-- ID -->
                                <Grid Grid.Row="0" Grid.Column="0" HorizontalOptions="Start" VerticalOptions="Center">
                                    <Ellipse Fill="#42313a" HeightRequest="30" WidthRequest="30"/>
                                    <Label Text="{Binding Id}" TextColor="#853c0f" HorizontalOptions="Center" VerticalOptions="Center"/>
                                </Grid>

                                <!-- Кнопки -->
                                <HorizontalStackLayout Grid.Row="1" Grid.ColumnSpan="2" HorizontalOptions="End" Spacing="10">
                                    <Button
                                    Text="Done"
                                    BackgroundColor="Green"
                                    TextColor="White"
                                    CornerRadius="25"
                                    Command="{Binding CompleteGoalCommand, Source={x:RelativeSource AncestorType={x:Type viewmodels:GoalHistoryViewModel}, Mode=FindAncestorBindingContext}}"
                                    CommandParameter="{Binding .}"
                                    HeightRequest="50"
                                    WidthRequest="140"/>

                                                            <Button
                                    Text="Remove"
                                    BackgroundColor="#fc2121"
                                    TextColor="#853c0f"
                                    CornerRadius="25"
                                    HeightRequest="50"
                                    WidthRequest="140"
                                    Command="{Binding DeleteItemCommand, Source={x:RelativeSource AncestorType={x:Type viewmodels:GoalHistoryViewModel}, Mode=FindAncestorBindingContext}}"
                                    CommandParameter="{Binding .}"/>        
                                </HorizontalStackLayout>

                            </Grid>


                        </StackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- _______________________________________________________________________________________________________________________________________________-->
        
        <Label Text="Finished Goals" FontSize="20" TextColor="White"/>
        <CollectionView ItemsSource="{Binding FinishedGoals}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Goal">
                    <Border StrokeThickness="1">
                        <StackLayout Padding="10" BackgroundColor="#9f4636">
                            <!-- Даты сверху -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- Дата создания -->
                                <Label 
                                Text="{Binding CreatedAt, StringFormat='Created: {0:dd/MM/yyyy}'}"
                                TextColor="Green"
                                FontSize="12"
                                Grid.Column="0"
                                HorizontalOptions="Start" />

                                                <!-- Дата окончания -->
                                    <Label 
                                Text="{Binding EndDate, StringFormat='Ends: {0:dd/MM/yyyy}'}"
                                TextColor="Red"
                                FontSize="12"
                                Grid.Column="1"
                                HorizontalOptions="End" />  
                            </Grid>

                            <Label FontAttributes="Bold" Text="{Binding Title}" />
                            <Label FontAttributes="Bold" Text="{Binding Description}" />
                            <Label FontAttributes="Bold" Text="{Binding GoalTime}" />

                            <!-- НИЗ -->
                            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*">

                                <!-- ID -->
                                <Grid Grid.Row="0" Grid.Column="0" HorizontalOptions="Start" VerticalOptions="Center">
                                    <Ellipse Fill="#42313a" HeightRequest="30" WidthRequest="30"/>
                                    <Label Text="{Binding Id}" TextColor="#853c0f" HorizontalOptions="Center" VerticalOptions="Center"/>
                                </Grid>
                            </Grid>


                        </StackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentPage>